{% extends "base.html" %}

{% block title %}All Questions{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">All Questions</h1>

    {% if metrics %}
    <div class="card mb-4">
        <div class="card-header">
            Overall Metrics
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <strong>Answered at least once:</strong> {{ metrics.answered_once }}
                </div>
                <div class="col-md-3">
                    <strong>Answered at least twice:</strong> {{ metrics.answered_twice }}
                </div>
                <div class="col-md-3">
                    <strong>Answered ≥ 2 times with avg score < 4:</strong> {{ metrics.answered_twice_low_score }}
                </div>
                <div class="col-md-3">
                    <strong>Max score ≥ 4:</strong> {{ metrics.max_score_high }}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row mb-3">
        <div class="col-md-3">
            <select id="filter-field" class="form-select">
                <option value="0">ID</option>
                <option value="1">Question Text</option>
                <option value="2">Category</option>
            </select>
        </div>
        <div class="col-md-7">
            <input type="text" id="filter-value" class="form-control" placeholder="Search in selected field...">
        </div>
        <div class="col-md-2">
            <div class="form-check form-switch mt-2">
                <input class="form-check-input" type="checkbox" id="exact-match" style="display: none;">
                <label class="form-check-label" for="exact-match" id="exact-match-label" style="display: none;">Exact Match</label>
            </div>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-md-12">
            <form method="get" action="{{ url_for('main.questions_list') }}" class="d-inline">
                {% if request.args.get('show_unanswered') %}
                    <input type="hidden" name="show_unanswered" value="">
                    <button type="submit" class="btn btn-secondary">Hide Unanswered</button>
                {% else %}
                    <input type="hidden" name="show_unanswered" value="true">
                    <button type="submit" class="btn btn-primary">Show Unanswered</button>
                {% endif %}
            </form>
        </div>
    </div>

    <table class="table table-striped table-sortable" id="questions-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Question Text</th>
                <th>Category</th>
                <th>Times Answered</th>
                <th>Avg. Score</th>
                <th>Max Score</th>
                <th>Avg. Duration (s)</th>
                <th>Min. Duration (s)</th>
                <th>Last Duration (s)</th>
                <th>Last Score</th>
            </tr>
        </thead>
        <tbody>
            {% for question in questions %}
            <tr>
                <td><a href="{{ url_for('main.question_detail', question_id=question.id) }}">{{ question.id }}</a></td>
                <td>{{ question.question_text }}</td>
                <td>{{ question.category }}</td>
                <td>{{ question.times_answered }}</td>
                <td>{{ "%.2f"|format(question.avg_score) if question.avg_score is not none else 'N/A' }}</td>
                <td>{{ question.max_score if question.max_score is not none else 'N/A' }}</td>
                <td>{{ "%.2f"|format(question.avg_duration) if question.avg_duration is not none else 'N/A' }}</td>
                <td>{{ "%.2f"|format(question.min_duration) if question.min_duration is not none else 'N/A' }}</td>
                <td>{{ "%.2f"|format(question.last_duration) if question.last_duration is not none else 'N/A' }}</td>
                <td>{{ question.last_score if question.last_score is not none else 'N/A' }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" class="text-center">No questions found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/table-questions.js') }}"></script>
{% endblock %}
